<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Log in</title>

    <!-- Load styles of the libraries -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <!-- Load own styles -->
    <link rel="stylesheet" href="./styles/index.css" type="text/css" />
    <link rel="stylesheet" href="./styles/signup.css" type="text/css" />

    <!-- Define the application icon -->
    <link rel="icon" href="./images/favicon.png" type="image/png" />
  </head>
  <body>
    <div class="container">
      <div class="row row-cols-2">
        <div class="col" id="form-container">
          <a href="viewer.html">
            <img src="./images/favicon.png" alt="LOGO" />
          </a>

          <h4>Welcome Back!</h4>
          <p>Login to continue easy campus navigation</p>
          <form class="signup-form" onsubmit="signin(event)">
            <label for="email">Email Address:</label><br />
            <input
              type="email"
              id="email"
              name="fname"
              required
              placeholder="Enter your email"
            /><br />
            <label for="password">Password:</label><br />
            <input
              type="password"
              id="password"
              required
              name="Password"
              placeholder="**********"
            /><br />
            <div>
              <label for="agree"> Forgot password?</label>
            </div>
            <input type="submit" placeholder="Log in" /><br />
          </form>
          <div class="myor">
            <div></div>
            <span>Or</span>
            <div></div>
          </div>
          <button class="google-signup" type="button" id="googleLogin">
            <img height="15" src="./images/google.png" />
            Continue with Google
          </button>
          <p>Don't have an account?<a href="signup.html">Sign up</a></p>
        </div>

        <div class="col" id="img-overlay">
          <img src="./images/signup_img.png" alt="" />
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./scripts/index.js"></script>

    <script>
      const signin = async (event) => {
        event.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        console.log({ email, password });

        try {
          const userCredential = await auth.signInWithEmailAndPassword(
            email,
            password
          );
          console.log("User signed in:", userCredential.user);
          const accessToken = userCredential.user.Aa;

          console.log({ accessToken });

          localStorage.idToken = accessToken;

          window.location.href = accessToken
            ? `${baseUrl}/viewer.html`
            : `${baseUrl}/login.html`;
        } catch (error) {
          const errorObj = JSON.parse(error.message);
          alert(errorObj.error.message.replaceAll("_", " "));
        }
      };
    </script>
  </body>
</html>
